"use strict";(self.webpackChunkcommerce_pwa_studio=self.webpackChunkcommerce_pwa_studio||[]).push([[9280],{58485:function(e,t,n){n.r(t),n.d(t,{_frontmatter:function(){return l},default:function(){return c}});var a=n(87462),o=n(45987),s=(n(35776),n(3905)),r=n(91515);const i=["components"],l={},d={_frontmatter:l},p=r.Z;function c(e){let{components:t}=e,n=(0,o.Z)(e,i);return(0,s.mdx)(p,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,s.mdx)("h1",{id:"create-a-tag-list-extension"},"Create a tag list extension"),(0,s.mdx)("p",null,"A tag list is a group of tags associated with a product.\nThis tutorial provides steps for creating and installing an extension that displays a tag list on the product details page in a Venia-based storefront."),(0,s.mdx)("h2",{id:"prerequisites"},"Prerequisites"),(0,s.mdx)("p",null,"Before you start this tutorial, make sure you have a storefront project set up using the steps outlined in the ",(0,s.mdx)("a",{parentName:"p",href:"/commerce-pwa-studio/tutorials/setup-storefront/"},"Setup your project")," topic.\nThis is the storefront you will use to install your extension in this tutorial."),(0,s.mdx)("h2",{id:"set-up-the-extension-project"},"Set up the extension project"),(0,s.mdx)("p",null,"Create a folder anywhere in your system and run Yarn's project creation script.\nThe script starts an interactive questionnaire that helps you fill out your project's ",(0,s.mdx)("inlineCode",{parentName:"p"},"package.json")," file."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-sh"},"mkdir tagList && \\\ncd tagList && \\\nyarn init\n")),(0,s.mdx)("p",null,"After answering the questions, the yarn CLI creates a ",(0,s.mdx)("inlineCode",{parentName:"p"},"package.json")," file that looks like the following:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "tagList",\n  "version": "1.0.0",\n  "description": "A tag list extension for a PWA Studio storefront",\n  "main": "index.js",\n  "license": "MIT"\n}\n')),(0,s.mdx)("h2",{id:"create-taglist-component-files"},"Create TagList component files"),(0,s.mdx)("p",null,"The core purpose of this extension is to provide a React component that renders a list of tags.\nUse the following command to create a directory and the files that define this component."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-sh"},"mkdir -p src/TagList && \\\ntouch src/Taglist/index.js && \\\ntouch src/Taglist/tag.js && \\\ntouch src/Taglist/tag.css && \\\ntouch src/Taglist/tagList.js && \\\ntouch src/Taglist/tagList.css\n")),(0,s.mdx)("h3",{id:"indexjs"},(0,s.mdx)("inlineCode",{parentName:"h3"},"index.js")),(0,s.mdx)("p",null,"Exporting modules from your component's ",(0,s.mdx)("inlineCode",{parentName:"p"},"index.js")," file is a common standard in a React project.\nIt lets another component import the tag list component using the ",(0,s.mdx)("inlineCode",{parentName:"p"},"TagList")," directory name."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},'/* src/TagList/index.js */\n\nexport { default } from "./tagList";\n')),(0,s.mdx)("h3",{id:"tagjs-and-tagcss"},(0,s.mdx)("inlineCode",{parentName:"h3"},"tag.js")," and ",(0,s.mdx)("inlineCode",{parentName:"h3"},"tag.css")),(0,s.mdx)("p",null,"The ",(0,s.mdx)("inlineCode",{parentName:"p"},"tag.js")," and ",(0,s.mdx)("inlineCode",{parentName:"p"},"tag.css")," files define a Tag component that renders a single tag in the tag list."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-jsx"},'/* src/TagList/tag.js */\n\nimport React from "react";\nimport Button from "@magento/venia-ui/lib/components/Button";\nimport { Link } from "@magento/venia-ui/lib/drivers";\n\nimport classes from "./tag.css";\n\nconst categoryUrlSuffix = ".html";\n\n// This is a component responsible for rendering a single tag\nconst Tag = (props) => {\n  // Destructures the props object into variables\n  const { value } = props;\n\n  const { name, url_path } = value;\n  const url = `/${url_path}${categoryUrlSuffix}`;\n\n  const buttonClasses = {\n    root_lowPriority: classes.root,\n    content: classes.content,\n  };\n\n  return (\n    <Link className={classes.link} to={url}>\n      <Button classes={buttonClasses} priority="low" type="button">\n        {name}\n      </Button>\n    </Link>\n  );\n};\n\n// Make this function the default exported of this module\nexport default Tag;\n')),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-css"},"/* src/TagList.tag.css */\n\n.root {\n  border: solid 1px #2680eb;\n  padding: 3px 9px;\n  margin: 5px;\n  border-radius: 6px;\n}\n\n.content {\n  color: #2680eb;\n  font-size: 0.875rem;\n}\n")),(0,s.mdx)("h3",{id:"taglistjs-and-taglistcss"},(0,s.mdx)("inlineCode",{parentName:"h3"},"tagList.js")," and ",(0,s.mdx)("inlineCode",{parentName:"h3"},"tagList.css")),(0,s.mdx)("p",null,"The ",(0,s.mdx)("inlineCode",{parentName:"p"},"tagList.js")," and ",(0,s.mdx)("inlineCode",{parentName:"p"},"tagList.css")," files define the main TagList component this package provides.\nIt accepts a ",(0,s.mdx)("inlineCode",{parentName:"p"},"categoriesListData")," object as a prop and renders the data as a tag list."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-jsx"},'/* src/TagList/tagList.js */\n\nimport React from "react";\nimport Tag from "./tag";\n\nimport classes from "./tagList.css";\n\nconst TagList = (props) => {\n  // Destructures the props object into variables\n  const { categoriesListData } = props;\n\n  const { categories } = categoriesListData;\n\n  // Returns nothing if there are no categories\n  if (!categories) {\n    return null;\n  }\n\n  // Converts the array of tag strings into an array of Tag components\n  const tagList = categories.map((category) => {\n    return <Tag key={category.name} value={category} />;\n  });\n\n  // Returns the list of Tag components inside a div container\n  return <div className={classes.root}>{tagList}</div>;\n};\n\nexport default TagList;\n')),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-css"},"/* src/TagList/tagList.css */\n\n.root {\n  display: flex;\n  flex-wrap: wrap;\n}\n")),(0,s.mdx)("h3",{id:"add-taglist-component-dependencies"},"Add TagList component dependencies"),(0,s.mdx)("p",null,"The TagList component requires third party libraries, such as React, to render the correct HTML.\nSince this package is an extension, you should list these as peer dependencies in your ",(0,s.mdx)("inlineCode",{parentName:"p"},"package.json")," file.\nThis safeguards against including more than one copy of the same dependency in the storefront project and final build."),(0,s.mdx)("p",null,"Use the following command to add the TagList component dependencies as peer dependencies:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-sh"},"yarn add --peer react @magento/venia-ui\n")),(0,s.mdx)("p",null,"This command creates a new ",(0,s.mdx)("inlineCode",{parentName:"p"},"peerDependencies")," entry in your ",(0,s.mdx)("inlineCode",{parentName:"p"},"package.json")," file that lists these dependencies."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-diff"},'  {\n    "name": "tagList",\n    "version": "1.0.0",\n    "description": "A tag list extension for a PWA Studio storefront",\n    "main": "index.js",\n-   "license": "MIT"\n+   "license": "MIT",\n+   "peerDependencies": {\n+     "@magento/venia-ui": "^6.0.1",\n+     "react": "^17.0.1"\n+   }\n  }\n')),(0,s.mdx)("h3",{id:"export-taglist-in-extension"},"Export TagList in extension"),(0,s.mdx)("p",null,"Your extension needs to export the TagList component in your project's main entry point to let other developers import it in their code.\nThe default main entry point for Node packages is the ",(0,s.mdx)("inlineCode",{parentName:"p"},"index.js")," file, so create this file using the following command:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-sh"},"touch index.js\n")),(0,s.mdx)("p",null,"Edit the file and add the following content:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},'export { default as TagList } from "./src/TagList";\n')),(0,s.mdx)("p",null,"Now, other developers can import the TagList component in their own projects using the following syntax:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},'import { TagList } from "tagList";\n')),(0,s.mdx)("h2",{id:"create-data-fetch-hook"},"Create data fetch hook"),(0,s.mdx)("p",null,"The TagList component requires data the ",(0,s.mdx)("a",{parentName:"p",href:"https://github.com/magento/pwa-studio/blob/develop/packages/peregrine/lib/talons/RootComponents/Product/productDetailFragment.gql.js"},"ProductDetailsFragment")," does not provide, so\nyou need to create a data fetch hook.\nThe data fetch hook is a custom React hook that sends a GraphQL query requesting the product categories for a product."),(0,s.mdx)("p",null,"Run the following command to create this file:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-sh"},"mkdir -p src/hooks && \\\ntouch src/hooks/useProductCategoriesList.js\n")),(0,s.mdx)("p",null,"Edit the file and add the following content:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},'/* src/hooks/useProductCategoriesList.js */\n\nimport { useMemo } from "react";\nimport { useQuery } from "@apollo/client";\nimport gql from "graphql-tag";\n\n// GraphQL query to fetch a list of categories for a product\nconst GET_PRODUCT_CATEGORIES = gql`\n  query getProductCategories($urlKey: String!) {\n    products(filter: { url_key: { eq: $urlKey } }) {\n      items {\n        categories {\n          name\n          url_path\n        }\n      }\n    }\n  }\n`;\n\nconst useProductCategoriesList = (props) => {\n  const { urlKey } = props;\n\n  const { error, loading, data } = useQuery(GET_PRODUCT_CATEGORIES, {\n    fetchPolicy: "cache-and-network",\n    nextFetchPolicy: "cache-first",\n    variables: {\n      urlKey: urlKey,\n    },\n  });\n\n  const categories = useMemo(() => {\n    if (data && data.products.items[0]) {\n      return data.products.items[0].categories;\n    }\n    return null;\n  }, [data]);\n\n  return {\n    error,\n    isLoading: loading,\n    categories,\n  };\n};\n\nexport default useProductCategoriesList;\n')),(0,s.mdx)("p",null,"This file requires two new dependencies, ",(0,s.mdx)("inlineCode",{parentName:"p"},"@apollo/client")," and ",(0,s.mdx)("inlineCode",{parentName:"p"},"graphql-tag"),".\nRun the following command to add these as peer dependencies to the ",(0,s.mdx)("inlineCode",{parentName:"p"},"package.json")," file:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-sh"},"yarn add --peer @apollo/client graphql-tag\n")),(0,s.mdx)("h2",{id:"create-wrapper-file"},"Create wrapper file"),(0,s.mdx)("p",null,"A wrapper file exports an interceptor that wraps a module in another file.\nAn interceptor module has access to the original module and the parameters it receives.\nThis lets the interceptor module run the original code along with its own custom logic that can change the incoming parameters or outgoing return value."),(0,s.mdx)("p",null,"For this extension, create a wrapper file for the ",(0,s.mdx)("inlineCode",{parentName:"p"},"useProductFullDetails()")," hook that calls the data fetch hook you created in a previous step and adds the result to its return value."),(0,s.mdx)("p",null,"First, create this file with the following command:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-sh"},"mkdir -p src/targets/ && \\\ntouch src/targets/wrapper.js\n")),(0,s.mdx)("p",null,"Edit this file and add the following content:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},'import useProductCategoriesList from "../hooks/useProductCategoriesList";\n\nexport default (original) => {\n  return function useProductFullDetails(props, ...restArgs) {\n    const { product } = props;\n\n    // Run the data fetch hook\n    const categoriesListData = useProductCategoriesList({\n      urlKey: product.url_key,\n    });\n\n    // Run the original, wrapped function\n    const { productDetails, ...defaultReturnData } = original(\n      props,\n      ...restArgs\n    );\n\n    // Add the new data to the data returned by the original function\n    return {\n      ...defaultReturnData,\n      productDetails: {\n        ...productDetails,\n        categoriesListData: categoriesListData,\n      },\n    };\n  };\n};\n')),(0,s.mdx)("h2",{id:"define-intercept-file"},"Define intercept file"),(0,s.mdx)("p",null,"The intercept file is where you directly interact with Target objects to apply customizations.\nIn this extension, the intercept file tells the build process to use Webpack loaders for ES Modules and CSS Modules.\nWithout these intructions, the build process will not know how to load the files in this extension."),(0,s.mdx)("p",null,"Create this file using the following command:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-sh"},"touch src/targets/intercept.js\n")),(0,s.mdx)("p",null,"Edit this file and add the following content:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},'module.exports = (targets) => {\n  const { Targetables } = require("@magento/pwa-buildpack");\n\n  const targetables = Targetables.using(targets);\n\n  targetables.setSpecialFeatures("esModules", "cssModules");\n};\n')),(0,s.mdx)("p",null,"This script uses ",(0,s.mdx)("inlineCode",{parentName:"p"},"@magento/pwa-buildpack"),", so you need to add this library as a dependency."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-sh"},"yarn add --peer @magento/pwa-buildpack\n")),(0,s.mdx)("p",null,"Next, edit your ",(0,s.mdx)("inlineCode",{parentName:"p"},"package.json")," file to point to the location of this extension's intercept file:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-diff"},'  {\n    "name": "tagList",\n    "version": "1.0.0",\n    "description": "A tag list extension for a PWA Studio storefront",\n    "main": "index.js",\n    "license": "MIT",\n    "peerDependencies": {\n      "@apollo/client": "^3.3.11",\n      "@magento/pwa-buildpack": "^8.0.1",\n      "@magento/venia-ui": "^6.0.1",\n      "graphql-tag": "^2.11.0",\n      "react": "^17.0.1"\n+   },\n+   "pwa-studio": {\n+     "targets": {\n+       "intercept": "src/targets/intercept"\n+     }\n    }\n  }\n\n')),(0,s.mdx)("h2",{id:"install-extension-locally"},"Install extension locally"),(0,s.mdx)("p",null,"Navigate to your storefront project directory and use the ",(0,s.mdx)("inlineCode",{parentName:"p"},"yarn add file:/path/to/local/folder")," syntax for the ",(0,s.mdx)("inlineCode",{parentName:"p"},"yarn add")," CLI to install your extension locally."),(0,s.mdx)("p",null,"For example:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-sh"},"yarn add --dev file:../extensions/tagList\n")),(0,s.mdx)("p",null,"This adds a new entry under ",(0,s.mdx)("inlineCode",{parentName:"p"},"devDependencies")," in your storefront project's ",(0,s.mdx)("inlineCode",{parentName:"p"},"package.json")," file that looks like the following:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-diff"},'    "style-loader": "~0.23.1",\n+   "tagList": "file:../extensions/tagList",\n    "terser-webpack-plugin": "~1.2.3",\n')),(0,s.mdx)("h2",{id:"intercept-venia-ui-components"},"Intercept Venia UI components"),(0,s.mdx)("p",null,"All scaffolded projects come with an intercept file called ",(0,s.mdx)("inlineCode",{parentName:"p"},"local-intercept.js"),".\nThis file lets you use ",(0,s.mdx)("a",{parentName:"p",href:"/commerce-pwa-studio/tutorials/targets/"},"Targets and Targetables")," to make modifications to the Venia application code without copying over the source file."),(0,s.mdx)("p",null,"Edit this file so it looks like the following:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},'/* local-intercept.js */\n\n// Import the Targetables manager\nconst { Targetables } = require("@magento/pwa-buildpack");\n\nfunction localIntercept(targets) {\n  // Create a bound Targetable factory\n  const targetables = Targetables.using(targets);\n\n  // Create a React component targetable linked to the productFullDetail.js file\n  const ProductDetails = targetables.reactComponent(\n    "@magento/venia-ui/lib/components/ProductFullDetail/productFullDetail.js"\n  );\n\n  // Add an import statement to the productFullDetail.js file and\n  // return the SingleImportStatement object\n  const TagList = ProductDetails.addImport("{TagList} from \'tagList\'");\n\n  // Insert the TagList component after the product description and pass in the\n  // new categoriesListData object added to the useProductFullDetails() hook\n  ProductDetails.insertAfterJSX(\n    "<RichText content={productDetails.description} />",\n    `<${TagList} categoriesListData={productDetails.categoriesListData} />`\n  );\n\n  // Create an ES Module targetable linked to the useProductFullDetail.js file\n  const useProductFullDetails = targetables.esModule(\n    "@magento/peregrine/lib/talons/ProductFullDetail/useProductFullDetail.js"\n  );\n\n  // Wrap the useProductFullDetail hook with your extension\'s wrapper file\n  useProductFullDetails.wrapWithFile(\n    "useProductFullDetail",\n    "tagList/src/targets/wrapper"\n  );\n}\n\nmodule.exports = localIntercept;\n')),(0,s.mdx)("h2",{id:"congratulations"},"Congratulations"),(0,s.mdx)("p",null,"You created a tag list extension and installed it in your development server!"),(0,s.mdx)("p",null,"Now, when you start your storefront application and navigate to a product page, you will see a list of tags associated with that product."))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-tutorials-extensions-taglist-index-md-80e568c06c460e938af0.js.map